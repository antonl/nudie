# Analyzing raw data

This is a short document summarizing the format of the data that the current
Labview FastDazzler code takes and we analyze it to generate 2D, pump probe,
and TG datasets.

## Raw data

When an experiment is finished, data is written out to a directory on the data
drive labeled with the day's date into a folder named for the job name and
batch number. For example, an experiment done on 11/11/16 called ```rc-tg```
would be stored at ```Z:\2D\Data\16-11-11\rc-tg-batch00```. Inside that folder,
there would be one or more ```*.spe``` files generated by the camera software
and matching text files ending in ```-analog1.txt``` and ```-analog2.txt```
which store the voltages measured by the ADC on channels 1 and 3. Additionally,
there are several text files containing meta-information about the run. These
are

- ```t1pos.txt```: t_1 delays in femtosecond, negative is larger delay. Note
  that due to a bug in the code, ```t1pos.txt``` is written out even for
  pump-probe and tg data, despite the fact that t_1 delays are not changed.
- ```t2pos.txt```: t_2 delays as two columns, one in millimeter of the
  population delay stage, and the other in fs, negative is larger delay.
- ```config.txt```: meta information about the experiment, listing information
  like the t2 == 0 position, center wavelength and lock wavelengths, and number
  of t1 waveforms. This file is only present since 2015.

Files holding data are tagged using the template
```{job-name]-{t2idx}-{tableidx}-{loopidx}```, where the indexes are
zero-padded two digit numbers. It is possible for these numbers to go above 99,
of course. Indexes refer to how the data is to be interpreted. 

Currently, ```t2idx``` is controlled by the number of population time positions
that are measured. The population times that this index refers to is contained
in the ```t2pos.txt``` file; it is not necessarily linear --- occasionally we
take data with hyperbolic spacing. 

```tableidx``` is controlled by the number of waveforms per table setting in
the data taking software. Due to technical limitations of the T3 Dazzler, a
table can only hold 256 distinct waveforms.  We use phase-cycling (to be
discussed later) each t1 delay that we want to measure corresponds to 6
waveforms. For a 2D measurement with 40 waveforms, the resulting table consists
of 244 waveforms, which just barely fits. If one changes the lock-frequency and
requires more t1 waveforms to appropriately sample the coherence decay, the
resulting number of waveforms no longer fits into a single table. One would
then change the number of t1 delays to measure, to say, 80, and would put
number of waveforms per table as 40. In this case, there would be two
```*.spe``` files per each t2 measurement, with table index 0 containing delays
0-39, and index 1 containing delays 40-79. *Warning*: make sure that there is
the same number of t1delays in each table, or the code won't work properly.

```loopidx``` is useful for repeating the same exact measurement more than
once. Due to technical limitations of the camera taking software, the camera
files can only be about 50 MB, corresponding to an integration time of about 60
seconds. It is sometimes advantageous to integrate more than this to average
laser shots together. This is done by keeping the camera integration time
constant and taking multiple files with the same integration time, effectively
multiplying the integration time by the number of loops. This generates files
with the last index incremented.
